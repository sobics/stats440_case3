---
title: "Case3 Part 1: Missing Data"
author: "Sonia Xu"
date: "November 6, 2017"
output: html_document
---

<!-- The data come from a study of malaria prevalence in Gambia. Each observation corresponds to one child who has been tested for the presence of malaria. The response Y is an indicator of whether malaria parasites were found in a blood sample from the child. The predictors are

AGE: age of the child, in years
BEDNET: indicator of whether the child has a net over his or her bed (1 = yes)
GREEN: a measure of how much greenery is around the child's village, derived from satellite images (units are arbitrary)
PHC: indicator for the presence of a public health clinic in the child's village (1 = yes)-->

#Preliminary Analysis
Preliminary analysis shows that the missing data is Missing at Random. Exploring the relationships between the features shows that $PHC$ and $GREEN$ are the most correlated. 
```{r include = F}
library(dplyr)
library(knitr)
library(ggplot2)
#read in the data set
gambia <-read.csv("gambiaMissing.csv")
```
#Dataset

The data set is relatively simple. The response variable we intend to predict is labeled $Y$ and records whether or not malaria was present in a patient's blood, with 1 being yes and 0 being no. $Age$ denotes the age of the subject. The ages were distributed across the values 1, 2, 3, and 4. Given the discrete nature of these levels, we plan to treat $Age$ as a categorical variable. The subjects were distributed roughly uniform in age, with the most frequent being 1. The table below displays the distribution.
$PHC$ and $BEDNET$ are binary variables; $PHC$ records whether or not a public health center is nearby, and $BEDNET$ records whether or not a mosquito net was present on the child's bed at home. 

$GREEN$ is a variable that shows the percentage of greenery around the child's home. In our sample, it has 5 distinct levels, with the factor 40.85 as the most frequently occurring level. The table below shows the distribution.

```{r}
table(gambia$GREEN) %>% as.data.frame() %>% kable()
```

#Missing Data: MAR
Initial exploratory data analysis reveals that the feature bednet contains missing data for 317 out of the 805 observations. To determine whether the data is Missing at Random or Missing Completely at Random, features from the missing dataset were compared in porportion to the features from the original dataset via quantiles. If the dataset were Missing Completely at Random, the quantiles would match for each feature. However, as the table of quantiles below shows, the missing dataset does not match in quantiles for the features $Age$ and $PHC$.

```{r echo = F}
attach(gambia)
i <- which(is.na(BEDNET))
m_gambia <- gambia[i,]
ggplot(gambia, aes(x = unique(AGE), y = as.vector(table(AGE)))) + geom_line()
Feature <- c("Missing Age", "Age", "Missing Green", "Green", "Missing PHC", "PHC")
quant_tab <- cbind(Feature, rbind(quantile(m_gambia$AGE), quantile(AGE), quantile(m_gambia$GREEN), quantile(GREEN), quantile(m_gambia$PHC), quantile(PHC)))
kable(quant_tab)
detach(gambia)
```

#Correlation Exploration
```{r echo = F}
pairs(m_gambia)
cor(gambia[-i,]) #index i can be found in my code
```
Visually looking at the correlation plots for each of the features from the non-missing data, none of the features appear highly correlated. When comparing the correlation matrix, the largest correlations are between the features, $PHC$ and $GREEN$ (-0.221) and PHC and $BEDNET$ (0.291). Similarly, looking at the missing data, the largest correlation is between $PHC$ and $GREEN$ (-0.137).   

#Relationship Between PHC and GREEN
```{r}
ggplot(gambia[-i,], aes(x=factor(PHC), y = factor(GREEN), color = factor(GREEN), size = 5)) + geom_point() + ggtitle("PHC ")
```

#Next Steps
Future plans include exploring different models that can: 
1. Imputate the missing data
2. Predict the presence of malaria   

##Imputating the Missing Data
In terms of imputating the missing data, we plan on clustering the data set on its other features via k-means, and then using these groups to predict $BEDNET$.

##Predicting the Presence of Malaria
The presence of malaria is a binary response, so we plan on using a logit model to fit the final dataset.   